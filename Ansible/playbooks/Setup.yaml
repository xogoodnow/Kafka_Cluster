---
- name: setting up Kafka cluster
  hosts: all
  become: true
  tasks:
    - name: Include variables
      include_vars: "all.yaml"

    - name: Setting the basis on all nodes
      include_role:
        name: "{{ item }}"
      with_items:
        - $PWD/roles/Pre_Setup
        - $PWD/roles/Docker_Install


    - name: Install and Configure Kafka instances
      include_role:
        name: "{{ item }}"
      with_items:
        - $PWD/roles/Kafka_Pre_Setup
        - $PWD/roles/Kafka_Install_Dockerized
      when: mode == 'kafka'

    - name: Set up Kafka Exoprter
      include_role:
        name: "{{ item }}"
      with_items:
        - $PWD/roles/Kafka_Install_Exporter
      when: mode == 'kafka'

    - name: Set up Kafka GUI
      include_role:
        name: "{{ item }}"
      with_items:
        - $PWD/roles/Kafka_Install_GUI
      when: mode == 'kafka'


    - name: Deploy Node exporter on all nodes
      include_role:
        name: "{{ item }}"
      with_items:
        - $PWD/roles/Node_Exporter_Setup
      when: mode == 'monitoring'

